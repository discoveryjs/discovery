var _t=new Uint8Array([0,0,74,83,79,78,88,76]),k=9;var at=268435455;var It=4294967295;var v=1<<0,C=1<<1,m=1<<2,O=1<<3,b=1<<4,P=1<<5,M=1<<6,y=1<<7,X=0,F=1,K=2,j=3,Q=4,q=5,H=6,ht=7,W=8,J=9,$=10,z=11,Z=12,Ut=31,Pt=~Ut,tt=224,Mt=~tt,et=7936,Vt=~et,nt=0,V=1,Nt=2,lt=3,xt=4,ut=5,st=6,rt=7,pt=8;var ot=16,it=32,Bt=~b,ct=C|P|M,Rt=new Uint8Array(256),B=new Uint8Array(8).map((e,t)=>(Rt[1<<t]=t,1<<t)),D=new Uint8Array(256).map((e,t)=>{for(let n=0;n<8;n++)e+=t>>n&1;return e}),Dt=Object.fromEntries(Object.entries({TYPE_UNDEF:v,TYPE_TRUE:P,TYPE_FALSE:M,TYPE_NULL:C,TYPE_NUMBER:m,TYPE_STRING:O,TYPE_OBJECT:b,TYPE_ARRAY:y}).map(([e,t])=>[t,e])),gt=Object.fromEntries(Object.entries({UINT_8:X,UINT_16:F,UINT_24:K,UINT_32:j,UINT_32_VAR:Q,INT_8:W,INT_16:J,INT_24:$,INT_32:z,INT_32_VAR:Z,FLOAT_32:q,FLOAT_64:H,DECIMAL:ht}).map(([e,t])=>[t,e]));var ft=new Uint8Array(32),g=class{constructor(t){this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.bytes=t,this.pos=0}readBytes(t){return this.bytes.subarray(this.pos,this.pos+=t)}readTypeIndex(t,n,r){let u=0,a=0;for(;n>0;)n&1&&(ft[u++]=a),a++,n>>=1;let _=new Uint8Array(t),x=32-Math.clz32(u-1),l=(1<<x)-1,s=this.readBytes(Math.ceil(x*t/8)),i=0,f=0,o=0;for(let I=0;I<t;I++)f<x&&(o|=s[i]<<f,f+=8,i++),_[I]=r?B[ft[o&l]]:ft[o&l],o>>=x,f-=x;return _}readVlq(){let t=this.view.getUint8(this.pos);if((t&1)===0)t=t>>1,this.pos+=1;else if((t&2)===0)t=this.view.getUint8(this.pos+1)<<6|t>>2,this.pos+=2;else if((t&4)===0)t=this.view.getUint16(this.pos+1,!0)<<5|t>>3,this.pos+=3;else{let n=this.view.getUint32(this.pos,!0);t=n>>>3&at,this.pos+=4,n>>>31&&(t+=this.readUintVar()*(1<<28))}return t}readUintVar(){let t=this.view.getUint8(this.pos++),n=t&127,r=128;for(;t&128;)t=this.view.getUint8(this.pos++),n+=(t&127)*r,r*=128;return n}readIntVar(){let t=this.readUintVar();return t&1?-(t-1)/2:t<=It?t>>>1:t/2}readUint8(){let t=this.view.getUint8(this.pos);return this.pos++,t}readInt8(){let t=this.view.getInt8(this.pos);return this.pos++,t}readUint16(){let t=this.view.getUint16(this.pos,!0);return this.pos+=2,t}readInt16(){let t=this.view.getInt16(this.pos,!0);return this.pos+=2,t}readUint24(){let t=this.view.getUint16(this.pos,!0)|this.view.getUint8(this.pos+2)<<16;return this.pos+=3,t}readInt24(){let t=this.view.getUint16(this.pos,!0),n=this.view.getUint8(this.pos+2),r=n&128?-(16777215-(t|n<<16)+1):t|n<<16;return this.pos+=3,r}readUint32(){let t=this.view.getUint32(this.pos,!0);return this.pos+=4,t}readInt32(){let t=this.view.getInt32(this.pos,!0);return this.pos+=4,t}readFloat32(){let t=this.view.getFloat32(this.pos);return this.pos+=4,t}readFloat64(){let t=this.view.getFloat64(this.pos);return this.pos+=8,t}};function G(e,t){switch(t){case X:return e.readUint8();case F:return e.readUint16();case K:return e.readUint24();case j:return e.readUint32();case Q:return e.readUintVar();case W:return e.readInt8();case J:return e.readInt16();case $:return e.readInt24();case z:return e.readInt32();case Z:return e.readIntVar();case q:return e.readFloat32();case H:return e.readFloat64()}}function yt(e){let t=e.readUint8();switch(t&15){case nt:case V:case st:case rt:t|=e.readUint8()<<8;break}return t}function h(e,t=e.readVlq()){let n=yt(e);return L(e,n,t)}function L(e,t,n,r=new Array(n)){let u=t&15,a=t&48,_=n,x=0,l=0;switch(a){case ot:{x=r[0]=e.readIntVar(),_--,l=1;break}case it:{x=e.readIntVar();break}}switch(u){case Nt:{for(let s=0;s<_;s++)r[l+s]=e.readVlq();break}case lt:{for(let s=0;s<_;s++)r[l+s]=e.readIntVar();break}case xt:{let s=e.readBytes(Math.ceil(_/2));for(let i=0,f=0;i<_;i++)f=i&1?f>>4:s[i>>1],r[l+i]=f&8?e.readVlq()*8+(f&7):f&7;break}case ut:{let s=e.readBytes(Math.ceil(_/2));for(let i=0,f=0;i<_;i++){f=i&1?f>>4:s[i>>1];let o=f&4?-1:1;r[l+i]=f&8?o*(e.readVlq()*4+(f&3)):o*(f&3)}break}case st:{let s=t>>8,i=(1<<s)-1,f=e.readBytes(Math.ceil(_*s/8)),o=0,I=0,c=0;for(let U=0;U<_;U++){for(;I<s;)c|=f[o]<<I,I+=8,o++;r[l+U]=c&i,c>>=s,I-=s}break}case rt:{let s=t>>8,i=(1<<s)-1,f=e.readBytes(Math.ceil(_*s/8)),o=0,I=0,c=0;for(let U=0;U<_;U++){for(;I<s;)c|=f[o]<<I,I+=8,o++;r[l+U]=c&1?-((c&i)>>1):(c&i)>>1,c>>=s,I-=s}break}case pt:{let s=r[0]=e.readIntVar(),i=e.readIntVar();for(let f=1;f<n;f++)s=r[f]=s+i;break}case nt:case V:{let s=u===V,i=t>>8,f=s?t&et|i&tt:i;if(D[i]>1){let I=e.readTypeIndex(_,f);for(let c=0;c<_;c++)r[l+c]=G(e,I[c])}else{let I=31-Math.clz32(f);for(let c=0;c<_;c++)r[l+c]=G(e,I)}break}default:throw new Error(`Unknown numeric array encoding method: ${u}`)}switch(a){case ot:{r[0]=x;for(let s=1;s<n;s++)r[s]+=r[s-1];break}case it:{for(let s=0;s<n;s++)r[s]+=x;break}}return r}var mt=new TextDecoder("utf8",{ignoreBOM:!0});function bt(e){if(e.readBytes(8).some((u,a)=>u!==_t[a]))throw new Error("Bad magic number");let n=e.readUint16();if(n!==k)throw new Error(`Unsupported jsonxl version "${n}", expected "${k}"`);let r=e.readUint16();return{version:n,flags:r}}function Ot(e){let t=mt.decode(e.readBytes(e.readVlq())),n=h(e),r=h(e),u=h(e),a=h(e),_=new Array(n),x=0;for(let l=0,s=0,i=0,f=0,o="";l<n.length;l++){let I=n[l],c=t.slice(s,s+=I>>2);I&2&&(c=o.slice(0,r[i++])+c),I&1&&(c=c+o.slice(-u[f++])),_[l]=c,o=c}return{readStrings(l,s){return a.slice(l,s).map(i=>_[i])},readString(){return _[a[x++]]}}}function wt(e){let t=h(e),n=0;return function(){return t[n++]}}function Yt(e){let t=h(e),n=h(e),r=0;return function(){return t[n[r++]]}}function Ct(e,t){let n=e.readVlq(),r=e.readVlq();if(n===0)return()=>null;let u=r?t(-r):[],a=new Array(n);for(let _=0;_<n;_++)a[_]={dict:h(e),refs:h(e),index:0};return function(x){let l=a[x],s=l.refs[l.index++],i=l.dict[s];return i===0?null:{key:u[i>>8],type:i&255}}}function Tt(e,t){let n=0;for(let r=0;r<e.length;r++)e[r]===t&&n++;return n}function jt(e){function t(o={}){let I=0,c;for(;c=i(I++);)o[c.key]=u(c.type);return o}function n(o=l()){if(o===0)return[];let I=s(),c=I>>16,U=I&65535,At=c&1,dt=c>>5&1,Et=c>>9&1,d=c>>1&255|(c&1)<<4,R=new Array(o),T=D[d]>1?a.readTypeIndex(o,d,!0):null;if(d&ct)if(T===null)R.fill(r(d));else for(let N=0;N<o;N++)T[N]&ct&&(R[N]=r(T[N]));if(d&O)for(let N=0;N<o;N++)(T===null||T[N]===O)&&(R[N]=x());if(d&m)if(d===m)L(a,U,o,R);else{let N=Tt(T,m),p=L(a,U,N);for(let E=0,A=0;E<o;E++)T[E]===m&&(R[E]=p[A++])}if(d&y)if(Et){let N=d===y?o:Tt(T,y),p=h(a,N),E=n();for(let A=0,S=0,w=0;A<o;A++)(T===null||T[A]===y)&&(R[A]=E.slice(w,w+=p[S++]))}else for(let N=0;N<o;N++)(T===null||T[N]===y)&&(R[N]=n());if(d&b){let N=d===b?R:[];for(let p=0,E=0;p<o;p++)(T===null||T[p]===b)&&(R[p]=N[E++]={});if(dt){let p=a.readVlq(),E=new Array(p);for(let A=0;A<p;A++)E[A]=x();for(let A=0;A<p;A++){let S=E[A],w=n(N.length);for(let Y=0;Y<N.length;Y++)w[Y]!==void 0&&(N[Y][S]=w[Y])}}if(At)for(let p=0;p<N.length;p++)t(N[p])}return R}function r(o){switch(o){default:return;case C:return null;case O:return x();case P:return!0;case M:return!1}}function u(o){switch(B[o&7]){case v:return;case C:return null;case O:return x();case m:return G(a,o>>3);case b:return t();case P:return!0;case M:return!1;case y:return n()}}let a=new g(e);bt(a);let{readStrings:_,readString:x}=Ot(a),l=wt(a),s=Yt(a),i=Ct(a,_),f=u(a.readUint8());if(a.pos!==e.byteLength)throw new Error("End of input not reached");return f}export{jt as decode};
