var ye=Object.create;var q=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ee=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Se(e))!ve.call(t,r)&&r!==s&&q(t,r,{get:()=>e[r],enumerable:!(n=be(e,r))||n.enumerable});return t};var ke=(t,e,s)=>(s=t!=null?ye(we(t)):{},Ee(e||!t||!t.__esModule?q(s,"default",{value:t,enumerable:!0}):s,t));var W=C((wt,J)=>{var Fe={8:"\\b",9:"\\t",10:"\\n",12:"\\f",13:"\\r",34:'\\"',92:"\\\\"};function Ne(t){return t>=55296&&t<=56319}function je(t){return t>=56320&&t<=57343}function $(t){return typeof t.pipe=="function"&&typeof t._read=="function"&&typeof t._readableState=="object"&&t._readableState!==null}function Me(t,e,s,n){switch(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),n!==null&&(s=n.call(t,String(e),s)),typeof s){case"function":case"symbol":s=void 0;break;case"object":if(s!==null){let r=s.constructor;(r===String||r===Number||r===Boolean)&&(s=s.valueOf())}break}return s}function Ie(t){return t===null||typeof t!="object"?1:Array.isArray(t)?3:2}function _e(t){return t===null||typeof t!="object"?1:typeof t.then=="function"?4:$(t)?t._readableState.objectMode?6:5:Array.isArray(t)?3:2}function Be(t){return typeof t=="function"?t:Array.isArray(t)?[...new Set(t.map(s=>{let n=s&&s.constructor;return n===String||n===Number?String(s):null}).filter(s=>typeof s=="string"))]:null}function qe(t){return typeof t=="number"?!Number.isFinite(t)||t<1?!1:" ".repeat(Math.min(t,10)):typeof t=="string"&&t.slice(0,10)||!1}J.exports={escapableCharCodeSubstitution:Fe,isLeadingSurrogate:Ne,isTrailingSurrogate:je,type:{PRIMITIVE:1,PROMISE:4,ARRAY:3,OBJECT:2,STRING_STREAM:5,OBJECT_STREAM:6},isReadableStream:$,replaceValue:Me,getTypeNative:Ie,getTypeAsync:_e,normalizeReplacer:Be,normalizeSpace:qe}});var G=C((vt,K)=>{K.exports=TextDecoder});var Y=C((Et,Q)=>{var{isReadableStream:Ve}=W(),ze=G(),E=1,Ue=2,He=new ze;function Z(t){return t!==null&&typeof t=="object"}function A(t,e){return t.name==="SyntaxError"&&e.jsonParseOffset&&(t.message=t.message.replace(/at position (\d+)/,(s,n)=>"at position "+(Number(n)+e.jsonParseOffset))),t}function $e(t,e){let s=t.length;t.length+=e.length;for(let n=0;n<e.length;n++)t[s+n]=e[n]}Q.exports=function(t){let e=new O;if(Z(t)&&Ve(t))return new Promise((s,n)=>{t.on("data",r=>{try{e.push(r)}catch(a){n(A(a,e)),e=null}}).on("error",r=>{e=null,n(r)}).on("end",()=>{try{s(e.finish())}catch(r){n(A(r,e))}finally{e=null}})});if(typeof t=="function"){let s=t();if(Z(s)&&(Symbol.iterator in s||Symbol.asyncIterator in s))return new Promise(async(n,r)=>{try{for await(let a of s)e.push(a);n(e.finish())}catch(a){r(A(a,e))}finally{e=null}})}throw new Error("Chunk emitter should be readable stream, generator, async generator or function returning an iterable object")};var O=class{constructor(){this.value=void 0,this.valueStack=null,this.stack=new Array(100),this.lastFlushDepth=0,this.flushDepth=0,this.stateString=!1,this.stateStringEscape=!1,this.pendingByteSeq=null,this.pendingChunk=null,this.chunkOffset=0,this.jsonParseOffset=0}parseAndAppend(e,s){this.stack[this.lastFlushDepth-1]===E?(s&&(this.jsonParseOffset--,e="{"+e+"}"),Object.assign(this.valueStack.value,JSON.parse(e))):(s&&(this.jsonParseOffset--,e="["+e+"]"),$e(this.valueStack.value,JSON.parse(e)))}prepareAddition(e){let{value:s}=this.valueStack;if(Array.isArray(s)?s.length!==0:Object.keys(s).length!==0){if(e[0]===",")return this.jsonParseOffset++,e.slice(1);if(e[0]!=="}"&&e[0]!=="]")return this.jsonParseOffset-=3,"[[]"+e}return e}flush(e,s,n){let r=e.slice(s,n);if(this.jsonParseOffset=this.chunkOffset+s,this.pendingChunk!==null&&(r=this.pendingChunk+r,this.jsonParseOffset-=this.pendingChunk.length,this.pendingChunk=null),this.flushDepth===this.lastFlushDepth)this.flushDepth>0?this.parseAndAppend(this.prepareAddition(r),!0):(this.value=JSON.parse(r),this.valueStack={value:this.value,prev:null});else if(this.flushDepth>this.lastFlushDepth){for(let a=this.flushDepth-1;a>=this.lastFlushDepth;a--)r+=this.stack[a]===E?"}":"]";this.lastFlushDepth===0?(this.value=JSON.parse(r),this.valueStack={value:this.value,prev:null}):this.parseAndAppend(this.prepareAddition(r),!0);for(let a=this.lastFlushDepth||1;a<this.flushDepth;a++){let i=this.valueStack.value;if(this.stack[a-1]===E){let o;for(o in i);i=i[o]}else i=i[i.length-1];this.valueStack={value:i,prev:this.valueStack}}}else{r=this.prepareAddition(r);for(let a=this.lastFlushDepth-1;a>=this.flushDepth;a--)this.jsonParseOffset--,r=(this.stack[a]===E?"{":"[")+r;this.parseAndAppend(r,!1);for(let a=this.lastFlushDepth-1;a>=this.flushDepth;a--)this.valueStack=this.valueStack.prev}this.lastFlushDepth=this.flushDepth}push(e){if(typeof e!="string"){if(this.pendingByteSeq!==null){let a=e;e=new Uint8Array(this.pendingByteSeq.length+a.length),e.set(this.pendingByteSeq),e.set(a,this.pendingByteSeq.length),this.pendingByteSeq=null}if(e[e.length-1]>127)for(let a=0;a<e.length;a++){let i=e[e.length-1-a];if(i>>6===3){a++,(a!==4&&i>>3===30||a!==3&&i>>4===14||a!==2&&i>>5===6)&&(this.pendingByteSeq=e.slice(e.length-a),e=e.slice(0,-a));break}}e=He.decode(e)}let s=e.length,n=0,r=0;e:for(let a=0;a<s;a++){if(this.stateString){for(;a<s;a++)if(this.stateStringEscape)this.stateStringEscape=!1;else switch(e.charCodeAt(a)){case 34:this.stateString=!1;continue e;case 92:this.stateStringEscape=!0}break}switch(e.charCodeAt(a)){case 34:this.stateString=!0,this.stateStringEscape=!1;break;case 44:r=a;break;case 123:r=a+1,this.stack[this.flushDepth++]=E;break;case 91:r=a+1,this.stack[this.flushDepth++]=Ue;break;case 93:case 125:r=a+1,this.flushDepth--,this.flushDepth<this.lastFlushDepth&&(this.flush(e,n,r),n=r);break;case 9:case 10:case 13:case 32:n===a&&n++,r===a&&r++;break}}r>n&&this.flush(e,n,r),r<s&&(this.pendingChunk!==null?this.pendingChunk+=e:this.pendingChunk=e.slice(r,s)),this.chunkOffset+=s}finish(){return this.pendingChunk!==null&&(this.flush("",0,0),this.pendingChunk=null),this.value}}});var w={name:"Discovery",mode:"modelfree",darkmode:"auto",data:null,model:{name:"Untitled model",slug:"default",cache:!1,upload:!0,download:!1,darkmode:"auto",inspector:!0,router:!0,meta:{description:["Running in `model free mode` since no config or model is set. However, you can load the JSON file, analyse it, and create your own report.","","See [documention](https://github.com/discoveryjs/discovery/blob/master/README.md) for details."]}}};var b=class{static setValue(e,s){if(!e.shouldPublish(s,e.value))return!1;let n=[],r=e.subscriber;for(e.value=s;r!==null;){let{callback:a,thisArg:i}=r;a!==null&&n.push(a.call(i,s,()=>e.unsubscribe(a,i))),r=r.subscriber}return n}constructor(e,s){this.value=e,this.shouldPublish=typeof s=="function"?s:this.shouldPublish,this.subscriber=null}get readonly(){let e=this;return{subscribe:this.subscribe.bind(this),subscribeSync:this.subscribeSync.bind(this),unsubscribe:this.unsubscribe.bind(this),get value(){return e.value}}}subscribe(e,s){return this.subscriber={callback:e,thisArg:s,subscriber:this.subscriber},()=>this.unsubscribe(e,s)}subscribeSync(e,s){let n=this.subscribe(e,s);return e.call(s,this.value,n),n}unsubscribe(e,s){let n=this,r=this.subscriber;for(;r!==null;){if(r.callback===e&&r.thisArg===s){r.callback=null,r.thisArg=null,n.subscriber=r.subscriber;break}n=r,r=r.subscriber}}shouldPublish(e,s){return e!==s}set(e){return this.constructor.setValue(this,e)!==!1}asyncSet(e){let s=this.constructor.setValue(this,e);return s===!1?Promise.resolve(!1):Promise.all(s).then(n=>n!==!1)}};function y(t,e,s){let n=document.createElement(t);typeof e=="string"&&(e={class:e});for(let r in e)if(hasOwnProperty.call(e,r)){if(e[r]===void 0)continue;r.startsWith("on")?n.addEventListener(r.substr(2),e[r]):n.setAttribute(r,e[r])}return Array.isArray(s)?s.forEach(r=>n.appendChild(r instanceof Node?r:xe(r))):typeof s=="string"&&(n.innerHTML=s),n}function xe(t){return document.createTextNode(String(t))}var Te=(()=>{let t=!1;try{let e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return t})(),ht=Te?Object.freeze({passive:!0,capture:!0}):!0;var P={request:{value:0,title:"Awaiting data"},receive:{value:.1,title:"Receiving data"},received:{value:.9,title:"Await app ready"},prepare:{value:.925,title:"Processing data (prepare)"},initui:{value:.975,title:"Rendering UI"},done:{value:1,title:"Done!"}};Object.values(P).forEach((t,e,s)=>{t.duration=(e!==s.length-1?s[e+1].value:0)-t.value});var V=t=>t|0,z=t=>typeof t=="function"?t:()=>{},De=async()=>{if(await new Promise(t=>setTimeout(t,1)),!document.hidden)return Promise.race([new Promise(requestAnimationFrame),new Promise(t=>setTimeout(t,8))])};function Ce(t,e){let{value:s,title:n,duration:r}=P[t],a=0,i=null;if(e){let{done:o,elapsed:l,units:c,completed:d,total:f}=e;f?(a=o?1:d/f,i=c==="bytes"?Math.round(a*100)+"%":`${d}/${f}`):(a=o?1:.1+Math.min(.9,l/2e4),i=c==="bytes"?(d/(1024*1024)).toFixed(1)+"MB":d)}return{stageTitle:n,progressValue:s+a*r,progressText:i,title:i?`${n} (${i})...`:t!=="done"?`${n}...`:n}}var v=class extends b{constructor({onTiming:e,onFinish:s,delay:n,domReady:r}){super({stage:null,progress:null,error:null}),this.finished=!1,this.awaitRepaint=null,this.lastStage="created",this.lastStageStart=null,this.timings=[],this.onTiming=z(e),this.onFinish=z(s),this.appearanceDelay=n===!0?200:Number(n)||0,this.domReady=r||Promise.resolve(),this.el=y("div","view-progress init",[y("div","title"),y("div","progress")])}recordTiming(e,s,n=performance.now()){let r={stage:e,title:P[e].title,duration:V(n-s)};this.timings.push(r),this.onTiming(r)}async setState(e){let{stage:s,progress:n,error:r}=e;if(this.finished)return;if(r){this.set("stage"in e?{stage:s,progress:n,error:r}:{...this.value,error:r});return}this.set(e);let a=s!==this.lastStage,i=performance.now();this.lastStage==="created"&&(this.startTime=i,this.domReady.then(()=>{let c=Math.max(0,this.appearanceDelay-V(performance.now()-i));c&&this.el.style.setProperty("--appearance-delay",`${c}ms`),getComputedStyle(this.el).opacity,this.el.classList.remove("init")})),a&&(this.lastStageStart!==null&&this.recordTiming(this.lastStage,this.lastStageStart,i),this.lastStage=s,this.lastStageStart=i,this.awaitRepaint=i);let{title:o,progressValue:l}=Ce(s,n);this.el.querySelector(".title").textContent=o,this.el.style.setProperty("--progress",l),(a||i-this.awaitRepaint>65&&i-this.lastStageStart>200)&&(await De(),this.awaitRepaint=performance.now())}finish(){this.finished||(this.finished=!0,this.lastStageStart!==null&&this.recordTiming(this.lastStage,this.lastStageStart),this.recordTiming("done",this.startTime),this.onFinish(this.timings),this.set({stage:"done"}))}dispose(){this.finish(),this.el.remove()}};var U=typeof new Blob().stream=="function"?t=>t.stream():Pe();function Pe(){try{return new ReadableStream({type:"bytes"}),Ae}catch{try{return new ReadableStream({}),Oe}catch{try{return new Response(new Blob).body.getReader(),Le}catch{}}}return Re}function H(t){return typeof t.arrayBuffer=="function"?t.arrayBuffer():new Promise((e,s)=>{let n=new FileReader;n.readAsArrayBuffer(t),n.onload=n.onerror=({type:r})=>{n.onload=n.onerror=null,r==="load"?e(n.result||n):s(new Error("Failed to read the blob/file"))}})}function Ae(t){let e=0;return new ReadableStream({type:"bytes",autoAllocateChunkSize:512*1024,pull(s){let n=s.byobRequest.view,r=t.slice(e,e+n.byteLength);return H(r).then(a=>{let i=new Uint8Array(a),o=i.byteLength;e+=o,n.set(i),s.byobRequest.respond(o),e>=t.size&&s.close()})}})}function Oe(t){let e=0;return new ReadableStream({pull(s){let n=t.slice(e,e+524288);return H(n).then(r=>{e+=r.byteLength,s.enqueue(new Uint8Array(r)),e==t.size&&s.close()})}})}function Le(t){return new Response(t).body}function Re(){throw new Error("Blob#stream() is not supported and no fallback can be applied, include https://github.com/MattiasBuelens/web-streams-polyfill")}var X=ke(Y(),1),L={stream:x,event:Ge,file:ee,url:Ze,push:Qe};function Je(t){try{return new URL(t,location.origin).origin===location.origin}catch{return!1}}function We(t,e,s){let r=0;return(0,X.default)(async function*(){let a=t.getReader(),i=Date.now();try{for(;;){let{done:o,value:l}=await a.read();if(o){await s({done:!0,elapsed:Date.now()-i,units:"bytes",completed:r,total:e});break}for(let c=0;c<l.length;c+=1048576){let d=c===0&&l.length-c<1048576?l:l.slice(c,c+1048576);r+=d.length,yield d,await s({done:!1,elapsed:Date.now()-i,units:"bytes",completed:r,total:e})}}}finally{a.releaseLock()}}).then(a=>({data:a,size:r}))}async function Ke(t,e){let s=async(n,r)=>(await e.asyncSet({stage:n}),await r());try{let n=Date.now(),{stream:r,data:a,size:i,validateData:o}=await s("request",t),l=Date.now()-n,{data:c,size:d}=a||await s("receive",()=>We(r,Number(i)||0,f=>e.asyncSet({stage:"receive",progress:f})));return typeof o=="function"&&o(c),await e.asyncSet({stage:"received"}),{data:c,size:d,payloadSize:Number(i)||0,time:Date.now()-n,requestTime:l}}catch(n){throw console.error("[Discovery] Error loading data:",n),await e.asyncSet({stage:"error",error:n}),n}}function x(t,e,s){let n=new b;return{state:n,result:Ke(t,n).then(r=>({...r,...e(r.data)})),...s}}function ee(t){return x(()=>({stream:U(t),size:t.size}),e=>({data:e,context:{name:t.name,createdAt:new Date(t.lastModified||Date.now()),data:e}}),{title:"Load data from file: "+t.name})}function Ge(t){let e=t.dataTransfer||t.target,s=e&&e.files&&e.files[0];return t.stopPropagation(),t.preventDefault(),ee(s)}function Ze(t,e){e=e||{};let s=typeof t=="string"?void 0:t,n=e.isResponseOk||(a=>a.ok),r=e.getContentSize||((a,i)=>Je(a)&&!i.headers.get("content-encoding")?i.headers.get("content-length"):i.headers.get("x-file-size"));return x(async()=>{let a=await fetch(s?"data:application/json,{}":t,e.fetch);if(n(a))return s?{data:s}:{stream:a.body,size:r(t,a),validateData:e.validateData};let i=a.headers.get("content-type")||"",o=await a.text();if(i.toLowerCase().startsWith("application/json")){let l=JSON.parse(o);o=l.error||l}throw o=new Error(o),o.stack=null,o},a=>({data:e.dataField?a[e.dataField]:a,context:{name:"Discovery",createdAt:e.dataField&&a.createdAt?new Date(Date.parse(a.createdAt)):new Date,...e.dataField?a:{data:a}}}),{title:"Load data from url: "+(s?"[explicit data]":t)})}function Qe(t,e){let s,n=new ReadableStream({start(r){s=r},cancel(){s=null}});return x(()=>({size:t,stream:n}),r=>({data:r.data,context:{name:r.name||"Discovery",createdAt:e||r.createdAt||Date.now(),data:r.data}}),{push(r){s.enqueue(r)},finish(){s.close(),s=null}})}function te({result:t,state:e},s){return new Promise((n,r)=>{let a=e.subscribeSync(({stage:i,progress:o,error:l})=>{if(l){a(),r(l);return}return i==="received"&&(a(),n(t)),s.setState({stage:i,progress:o})})})}var k=class{constructor(){this.listeners=Object.create(null)}on(e,s){return this.listeners[e]={callback:s,next:this.listeners[e]||null},this}once(e,s){return this.on(e,function n(...r){s.apply(this,r),this.off(e,n)})}off(e,s){let n=this.listeners[e]||null,r=null;for(;n!==null;){if(n.callback===s){n.callback=null,r?r.next=n.next:this.listeners[e]=n.next;break}r=n,n=n.next}return this}emit(e,...s){let n=this.listeners[e]||null,r=!1;for(;n!==null;)typeof n.callback=="function"&&n.callback.apply(this,s),r=!0,n=n.next;return r}};function Ye(t){let e="__storage_test__"+Math.random(),s;try{s=window[t]}catch{return null}try{s.setItem(e,e),s.removeItem(e)}catch(n){if(!(n instanceof DOMException&&(n.code===22||n.code===1014||n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s.length!==0))return null}return s}function se(t){let e=new Map;return e.storage=Ye(t),e.getOrCreate=s=>e.get(s)||Xe(s,e),e.getOrCreate.available=e.storage!==null,e}var R=new Map([["session",se("sessionStorage")],["local",se("localStorage")]]),Pt=R.get("session").getOrCreate,re=R.get("local").getOrCreate;addEventListener("storage",t=>{for(let[,e]of R)e.storage===t.storageArea&&e.has(t.key)&&e.get(t.key).forceSync()});function Xe(t,e){let s=null,n=new k,r=(i=e.storage.getItem(t))=>{s!==i&&n.emit("change",s=i)},a={get value(){return this.get()},get(){return s},set(i){e.storage&&(e.storage.setItem(t,i),r())},delete(){e.storage&&(e.storage.removeItem(t),r())},forceSync(){return e.storage&&r(),this.get()},on(i,o){return n.on("change",i),o&&i(s),()=>n.off("change",i)},off(i){n.off("change",i)}};return e.set(t,a),a.forceSync(),a}var et=new Set([!0,!1,"auto","disabled"]),ae=new Set,ie=matchMedia("(prefers-color-scheme:dark)"),oe=re("discoveryjs:darkmode"),ne=new Map([["true",!0],["false",!1],["auto","auto"]]),T=null;function tt(){for(let t of ae)t.mode==="auto"&&t.set("auto")}function le(t){let e=ne.has(t)?ne.get(t):null;if(T!==e){T=e;for(let s of ae)s.persistent&&s.mode!=="disabled"&&s.set(e!==null?e:"auto")}}le(oe.value);oe.on(le);ie.addListener(tt);function st(t,e){return(t==="off"||t==="disable")&&(t="disabled"),t!=="disabled"&&e&&T!==null&&(t=T),t}function rt(t){return et.has(t)||(t="disabled"),t==="auto"?ie.matches:t===!0}function ce(t,e){return rt(st(t,e))}var nt={"font-family":"Tahoma, Verdana, Arial, sans-serif","font-size":"16px","line-height":"1.6","-webkit-text-size-adjust":"none","text-size-adjust":"none","background-color":"var(--discovery-background-color, white)",color:"var(--discovery-color, black)","transition-property":"background-color, color","transition-duration":".25s","transition-timing-function":"ease-in"},at={"--discovery-background-color":"#242424","--discovery-color":"#cccccc"},de=new WeakSet,F=new WeakMap;function ue(t,e,s){e in s||(s[e]=[t.style.getPropertyValue(e),t.style.getPropertyPriority(e)])}function pe(t,e){e=e||{},F.has(t)||F.set(t,Object.create(null));let s=ce(e.darkmode,e.darkmodePersistent),n=F.get(t);for(let[r,a]of Object.entries(nt))(de.has(t)||!/^transition/.test(r))&&(ue(t,r,n),t.style.setProperty(r,a));for(let[r,a]of Object.entries(at))ue(t,r,n),s?t.style.setProperty(r,a):t.style.removeProperty(r);return de.add(t),s}function N(t,e){let s=y("style",null,":host{display:none}"),n=new Set,r=Promise.resolve();return Array.isArray(e)&&(t.append(...e.map(a=>{switch(typeof a=="string"&&(a={type:"style",content:a}),a.type){case"style":case"inline":return y("style",{media:a.media},a.content);case"link":case"external":{let i,o,l=new Promise((d,f)=>{i=d,o=f});return n.add(l),y("link",{rel:"stylesheet",href:a.href,media:a.media,onerror(d){n.delete(l),o(d),n.size||s.remove()},onload(){n.delete(l),i(),n.size||s.remove()}})}default:throw new Error(`Unknown type "${a.type}" for a style descriptor`)}})),n.size&&(r=Promise.all(n),t.append(s))),r}function fe(){return[parseInt(performance.timeOrigin,10).toString(16),parseInt(1e4*performance.now(),10).toString(16),String(Math.random().toString(16).slice(2))].join("-")}function it(t,e){return new v({delay:300,domReady:t,title:e,onTiming:({title:s,duration:n})=>console.log(`[Discovery/loader] ${s} \u2013 ${n}ms`)})}function he(t){t=t||{};let e=t.container||document.body,s=document.createElement("div"),n=s.attachShadow({mode:"open"});if(t.dataSource&&!L.hasOwnProperty(t.dataSource))throw new Error(`dataSource "${t.dataSource}" is not supported`);pe(e,t)&&s.setAttribute("darkmode","");let a=L[t.dataSource||"url"],i=t.data?t.dataSource==="push"?a():a(t.data,t.loadDataOptions):{result:Promise.resolve({})};i.push&&(window.discoveryLoader={push:i.push,finish:()=>{delete window.discoveryLoader,i.finish()}});let o=N(n,t.styles),l=t.progressbar||it(o,i.title),c=t.embed?ot(i):()=>{};return i.state&&te(i,l),n.append(l.el),e.append(s),Object.assign(i.result,{el:s,shadowRoot:n,progressbar:l,disposeEmbed:c})}function ot(t){let e=fe(),s=window.parent,n=[],r=(l,c=null)=>{s.postMessage({from:"discoveryjs-app",id:e,type:l,payload:c},"*")},a=()=>r("destroy"),i=l=>{let{id:c,type:d}=l.data||{};if(c===e)switch(d){case"defineAction":{n.push(l.data);break}default:console.error(`[Discovery/loader] Unknown preload message type "${d}"`)}};if(s===window)return;addEventListener("message",i,!1),addEventListener("unload",a,!1),r("preinit",{page:{hash:location.hash||"#"}});let o=t.state?t.state.subscribeSync(({stage:l,progress:c,error:d})=>((d||l==="received")&&o(),r("loadingState",{stage:l,progress:c,error:d}))):()=>{};return()=>(removeEventListener("message",i,!1),removeEventListener("unload",a,!1),o(),a(),{hostId:e,postponeMessages:n})}var I=t=>({type:"link",href:t});function me(t,e,s,n){let r=document.body,a=String(Math.random()).slice(2,18).padStart(16,"0"),i=he({...n,loadDataOptions:{dataField:"data",fetch:{headers:{"Cache-Control":"no-cache, no-transform","x-data-request-id":a}}},container:r});return lt(i,a),Promise.all([t,i]).then(([o,{data:l,context:c}])=>o({...s,styles:e},i.progressbar,l,c)).then(()=>{i.el.remove()},o=>{let l=document.querySelector("body > .discovery"),c=document.createElement("div");if(c.firstChild&&(c.className="action-buttons",i.progressbar.el.before(c)),!o.supressLoadDataError){let d=document.createElement("pre");d.className="error",d.append(document.createTextNode("[ERROR] "+o+(o.stack?`

`+o.stack:""))),i.progressbar.el.replaceWith(d)}i.progressbar.dispose(),l&&l.remove()})}function lt(t,e){let s=!1,n=!0,r=document.createElement("div"),a=setTimeout(()=>{if(t.progressbar.lastStage!=="request")return;let i=t.progressbar.onTiming,o=new EventSource("data-status?data-request-id="+e),l,c,d,f,S,B,D=h=>{if(!(!n||!isFinite(h)||d!==void 0&&h<=d)){if(clearTimeout(f),d=Number(h),c&&d-c>=1e3&&(r.querySelector(":scope > .header > .elapsed-time").textContent=M(d-c,s?1:0)),l)for(let{started:p,elapsedTimeEl:u}of l.values())p&&(u.textContent=M(d-p,1));S=Date.now(),f=setTimeout(()=>D(d+(Date.now()-S)-5),42)}};o.addEventListener("open",()=>{r.classList.remove("init")},{once:!0}),o.addEventListener("message",h=>{try{let p=JSON.parse(h.data);switch(p.type){case"start":c=p.timestamp;break;case"finish":break;case"crash":if(s=!0,l)for(let{started:u,el:m}of l.values())u&&(m.classList.add("crashed"),m.classList.remove("started"),m.classList.toggle("collapsed",m!==B));break;case"stderr":case"stdout":{let u=document.createElement("div");if(u.className=p.type,u.append(document.createTextNode(p.chunk)),!l)r.lastChild.append(u),j(u);else{let m=l.get(p.stepId);m&&(m.contentEl.append(u),m.el.classList.add("has-output"),j(u),p.type=="stderr"&&(B=m.el))}break}case"plan":{let u=ge(p.plan.steps);l=u.map,r.lastChild.innerHTML="",r.lastChild.appendChild(u.el);break}case"plan-step-event":{let u=l.get(p.stepId);if(u)switch(p.stepEvent){case"start":u.started=p.timestamp,u.el.classList.add("started"),j(u.el);break;case"finish":u.elapsedTimeEl.textContent=M(p.timestamp-u.started),u.started=!1,u.el.classList.remove("started"),u.el.classList.add("finished");break;case"summary":u.summaryEl.innerHTML=dt(p.data);break;default:console.warn("Unhandled data status SSE pipeline step event",p)}else console.warn("Pipeline step not found",p);break}default:console.warn("Unhandled data status SSE event",p)}D(p.timestamp)}catch(p){console.error("SSE message parse error",p)}}),o.addEventListener("server-time",({data:h})=>{D(h)}),o.addEventListener("done",()=>{o.close(),n=!1}),t.progressbar.onTiming=h=>{i(h),h.lastStage!=="request"&&(r.classList.add("finished"),o.close(),n=!1)}},150);r.className="data-status init",r.innerHTML='<div class="header">Getting data: <span class="elapsed-time"></span></div><div class="output"></div>',r.firstChild.addEventListener("click",function(){r.classList.toggle("collapsed")},!0),t.progressbar.el.append(r),t.then(()=>clearTimeout(a),i=>{if(n=!1,!r.classList.contains("init")){t.progressbar.el.after(r),r.classList.add("crashed"),r.firstChild.firstChild.textContent="Getting data failed in ",s?(i.supressLoadDataError=!0,t.el.classList.add("generate-data-crash")):r.classList.add("compliment-error","collapsed");for(let o of r.querySelectorAll(".plan-step.started"))o.classList.remove("started")}})}function j(t){try{typeof t.scrollIntoViewIfNeeded=="function"?t.scrollIntoViewIfNeeded(!1):t.scrollIntoView({block:"nearest"})}catch{}}function ge(t,e=0,s=new Map){let n=document.createElement("ul");n.className="plan-step-list",n.style.setProperty("--level",e);for(let r of t){let a=n.appendChild(document.createElement("li")),i=a.appendChild(document.createElement("div")),o=i.appendChild(document.createElement("span")),l=i.appendChild(document.createElement("span")),c=i.appendChild(document.createElement("span")),d=i.appendChild(document.createElement("span")),f=i.appendChild(document.createElement("span")),S=a.appendChild(document.createElement("div"));s.set(r.id,{step:r,el:a,elapsedTimeEl:f,summaryEl:d,contentEl:S,started:!1}),a.className="plan-step collapsed",i.className="plan-step__header",i.addEventListener("click",()=>a.classList.toggle("collapsed")),o.className="plan-step__header-toggle",l.className="plan-step__header-status",c.className="plan-step__header-content",c.textContent=r.name||"Untitled",d.className="plan-step__header-summary",f.className="plan-step__elapsed-time",S.className="plan-step__content",r.steps&&a.append(ge(r.steps,e+1,s).el)}return{el:n,map:s}}function ct(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function dt(t,e=!0){let s=e&&typeof t!="number"?ct(String(t)):String(t);return s.length>3?s.replace(/\.\d+(eE[-+]?\d+)?|\B(?=(\d{3})+(\D|$))/g,n=>n||'<span class="num-delim"></span>'):s}function M(t,e=1){return t<1e3?t+"ms":t<1e4?(t/1e3).toFixed(e)+"s":t<6e4?Math.round(t/1e3)+"s":`${Math.floor(t/6e4)}:${String(Math.floor(t/1e3)%60).padStart(2,"0")}`}var g=w.model||{},_={mode:w.mode,darkmodePersistent:!0,setup:w,...g?{darkmode:g.darkmode,upload:g.upload,download:g.download,inspector:g.inspector,router:g.router,cache:g.cache,cacheReset:g.cacheReset,meta:g.meta}:null};me(import("./model.js").then(t=>t.default),[I("model.css")],_,{styles:[I("model-loader.css")],darkmode:_.darkmode,darkmodePersistent:_.darkmodePersistent,dataSource:"url",data:w.data});
